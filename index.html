<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M-PESA Transaction Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f7f7f7; }
    .container { max-width: 700px; margin: auto; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 2px 12px #bbb; }
    h1 { color: #009e3a; }
    .info { margin-top: 16px; color: #555; }
    table { width: 100%; border-collapse: collapse; margin-top: 24px; }
    th, td { padding: 10px 8px; text-align: left; }
    th { background: #009e3a; color: #fff; }
    tr:nth-child(even) { background: #f2f2f2; }
    .credit { color: #009e3a; font-weight: bold; }
    .debit { color: #d32f2f; font-weight: bold; }
    .small { color: #888; font-size: 0.95em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>M-PESA Transaction Tracker</h1>
    <p>This site is connected to your backend API for M-PESA transaction ingestion.</p>
    <div class="info">
      <strong>Backend API:</strong> <code>/api/mpesa</code><br>
      <strong>Status:</strong> Ready for Automate integration.
    </div>
    <h2 style="margin-top:32px;">Latest Transactions</h2>
    <div id="transactions">Loading...</div>
  </div>
  <script>
    function formatDateTime(dt) {
      const d = new Date(dt);
      return d.toLocaleString();
    }
    async function fetchTransactions() {
      const res = await fetch('http://localhost:3000/api/transactions', {
        headers: { 'Authorization': 'Bearer YOUR_API_KEY' }
      });
      const data = await res.json();
      const container = document.getElementById('transactions');
      if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = '<em>No transactions yet.</em>';
        return;
      }
      container.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Amount</th>
              <th>Currency</th>
              <th>Counterparty</th>
              <th>Phone</th>
              <th>Date/Time</th>
              <th>Balance After</th>
            </tr>
          </thead>
          <tbody>
            ${data.map(tx => `
              <tr>
                <td class="${tx.transaction_type}">${tx.transaction_type.toUpperCase()}</td>
                <td>${tx.amount}</td>
                <td>${tx.currency}</td>
                <td>${tx.counterparty_name}</td>
                <td>${tx.counterparty_phone}</td>
                <td class="small">${formatDateTime(tx.transaction_datetime)}</td>
                <td>${tx.balance_after}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }
    fetchTransactions();
    setInterval(fetchTransactions, 10000); // refresh every 10 seconds
  </script>
</body>
</html>
